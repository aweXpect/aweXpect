"use strict";(globalThis.webpackChunkpages=globalThis.webpackChunkpages||[]).push([[9854],{1844(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"mockolate/special-types/httpclient","title":"HttpClient","description":"Mockolate supports mocking HttpClient out of the box, with no special configuration required. You can set up, use, and","source":"@site/docs/mockolate/special-types/01-httpclient.md","sourceDirName":"mockolate/special-types","slug":"/mockolate/special-types/httpclient","permalink":"/docs/mockolate/special-types/httpclient","draft":false,"unlisted":false,"editUrl":"https://github.com/aweXpect/aweXpect/tree/main/Docs/pages/docs/mockolate/special-types/01-httpclient.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"mockolateSidebar","previous":{"title":"Special Types","permalink":"/docs/category/special-types"},"next":{"title":"Delegates","permalink":"/docs/mockolate/special-types/delegates"}}');var i=n(4848),o=n(8453);const c={},r="HttpClient",a={},l=[{value:"All HTTP Methods",id:"all-http-methods",level:2},{value:"URI matching",id:"uri-matching",level:2},{value:"Scheme",id:"scheme",level:3},{value:"Host",id:"host",level:3},{value:"Port",id:"port",level:3},{value:"Path",id:"path",level:3},{value:"Query",id:"query",level:3},{value:"Content Matching",id:"content-matching",level:2},{value:"String content",id:"string-content",level:3},{value:"Binary content",id:"binary-content",level:3},{value:"Form data content",id:"form-data-content",level:3}];function h(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"httpclient",children:"HttpClient"})}),"\n",(0,i.jsxs)(t.p,{children:["Mockolate supports mocking ",(0,i.jsx)(t.code,{children:"HttpClient"})," out of the box, with no special configuration required. You can set up, use, and\nverify HTTP interactions just like with any other interface or class."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Example: Mocking HttpClient for a Chocolate Dispenser Service"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'HttpClient httpClient = Mock.Create<HttpClient>();\nhttpClient.SetupMock.Method\n    .PostAsync(\n        It.IsAny<string>(),\n        It.IsHttpContent())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n\nHttpResponseMessage result = await httpClient.PostAsync("https://aweXpect.com/api/chocolate/dispense",\n    new StringContent("""\n                      { "type": "Dark", "amount": 3 }\n                      """, Encoding.UTF8, "application/json"));\n\nawait That(result.IsSuccessStatusCode).IsTrue();\nhttpClient.VerifyMock.Invoked.PostAsync(\n    It.IsUri("*aweXpect.com/api/chocolate/dispense*").ForHttps(),\n    It.IsHttpContent("application/json").WithStringMatching("*\\"type\\": \\"Dark\\"*\\"amount\\": 3*")).Once();\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The custom extensions for the ",(0,i.jsx)(t.code,{children:"HttpClient"})," are in the ",(0,i.jsx)(t.code,{children:"Mockolate.Web"})," namespace."]}),"\n",(0,i.jsxs)(t.li,{children:["Under the hood, the setups, requests and verifications are forwarded to a mocked ",(0,i.jsx)(t.code,{children:"HttpMessageHandler"}),".\nAs they therefore all forward to the ",(0,i.jsx)(t.code,{children:"SendAsync"})," method, you can mix using a string or an ",(0,i.jsx)(t.code,{children:"Uri"})," parameter in setup or\nverification."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"all-http-methods",children:"All HTTP Methods"}),"\n",(0,i.jsx)(t.p,{children:"Mockolate supports all standard HTTP methods:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"// GET\nhttpClient.SetupMock.Method\n    .GetAsync(It.IsAny<string>())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.NoContent));\n\n// POST\nhttpClient.SetupMock.Method\n    .PostAsync(It.IsAny<string>(), It.IsAny<HttpContent>())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n\n// PUT\nhttpClient.SetupMock.Method\n    .PutAsync(It.IsAny<string>(), It.IsAny<HttpContent>())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n\n// DELETE\nhttpClient.SetupMock.Method\n    .DeleteAsync(It.IsAny<string>())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.NoContent));\n\n// PATCH\nhttpClient.SetupMock.Method\n    .PatchAsync(It.IsAny<string>(), It.IsAny<HttpContent>())\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n"})}),"\n",(0,i.jsxs)(t.p,{children:["For all HTTP methods you can add an optional cancellation token parameter.\nIf no parameter is provided, it matches any ",(0,i.jsx)(t.code,{children:"CancellationToken"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'var cts = new CancellationTokenSource();\nhttpClient.SetupMock.Method\n    .GetAsync(It.IsAny<string>(), It.Is(cts.Token))\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n\nawait httpClient.GetAsync("https://example.com", cts.Token);\n'})}),"\n",(0,i.jsx)(t.h2,{id:"uri-matching",children:"URI matching"}),"\n",(0,i.jsxs)(t.p,{children:["Use ",(0,i.jsx)(t.code,{children:"It.IsUri(string?)"})," to match URIs using a wildcard pattern against the string representation of the URI.\nThe pattern supports ",(0,i.jsx)(t.code,{children:"*"})," to match zero or more characters and ",(0,i.jsx)(t.code,{children:"?"})," to match a single character."]}),"\n",(0,i.jsx)(t.h3,{id:"scheme",children:"Scheme"}),"\n",(0,i.jsxs)(t.p,{children:["Filter requests by URI scheme using ",(0,i.jsx)(t.code,{children:".ForHttps()"})," or ",(0,i.jsx)(t.code,{children:".ForHttp()"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'// Match only HTTPS requests\nhttpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri("*aweXpect.com*").ForHttps())\n    .Once();\n\n// Match only HTTP requests\nhttpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri("*aweXpect.com*").ForHttp())\n    .Never();\n'})}),"\n",(0,i.jsx)(t.h3,{id:"host",children:"Host"}),"\n",(0,i.jsxs)(t.p,{children:["Filter requests by host using ",(0,i.jsx)(t.code,{children:".WithHost(string)"}),". You can provide a wildcard pattern to match against the host name:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithHost("*aweXpect.com*"))\n    .Once();\n'})}),"\n",(0,i.jsx)(t.h3,{id:"port",children:"Port"}),"\n",(0,i.jsxs)(t.p,{children:["Filter requests on a specific port using ",(0,i.jsx)(t.code,{children:".WithPort(int)"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"httpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithPort(443))\n    .Once();\n"})}),"\n",(0,i.jsx)(t.h3,{id:"path",children:"Path"}),"\n",(0,i.jsxs)(t.p,{children:["Filter requests by path using ",(0,i.jsx)(t.code,{children:".WithPath(string)"}),". You can provide a wildcard pattern to match against the path:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithPath("/foo/*"))\n    .Once();\n'})}),"\n",(0,i.jsx)(t.h3,{id:"query",children:"Query"}),"\n",(0,i.jsxs)(t.p,{children:["Filter requests by query parameters using ",(0,i.jsx)(t.code,{children:".WithQuery(...)"}),". You can provide one or many key-value pairs or a raw query\nstring to match against the query parameters. The order of the key-value pairs does not matter:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'// Match query string containing "x=42"\nhttpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithQuery("x", "42"))\n    .Once();\n// Match query string containing "x=42" and "y=foo" (in any order)\nhttpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithQuery(("x", "42"), ("y", "foo")))\n    .Once();\n// Match query string containing "x=42" and "y=foo" (in any order)\nhttpClient.VerifyMock.Invoked\n    .GetAsync(It.IsUri().WithQuery("x=42&y=foo"))\n    .Once();\n'})}),"\n",(0,i.jsx)(t.h2,{id:"content-matching",children:"Content Matching"}),"\n",(0,i.jsxs)(t.p,{children:["Use ",(0,i.jsx)(t.code,{children:"It.IsHttpContent(string?)"})," to match the HTTP content, optionally providing an expected media type header value:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.SetupMock.Method\n    .PostAsync(\n        It.IsAny<string>(),\n        It.IsHttpContent("application/json"))\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n'})}),"\n",(0,i.jsx)(t.h3,{id:"string-content",children:"String content"}),"\n",(0,i.jsx)(t.p,{children:"To verify against the string content, use the following methods:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithString(string)"}),": to match the content exactly as provided"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithStringMatching(string)"}),": to match the content using wildcard patterns"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithStringMatching(string).AsRegex()"}),": to match the content using regular expressions"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.SetupMock.Method\n    .PostAsync(\n        It.IsAny<string>(),\n        It.IsHttpContent("application/json").WithStringMatching("*\\"type\\": \\"Dark\\"*"))\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Add the ",(0,i.jsx)(t.code,{children:".IgnoringCase()"})," modifier to make the string matching case-insensitive."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"binary-content",children:"Binary content"}),"\n",(0,i.jsx)(t.p,{children:"To verify against the binary content, use the following methods:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithBytes(byte[])"}),": to match the content exactly as provided"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithBytesContaining(byte[])"}),": to match the content to contain the provided byte sequence in order"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.SetupMock.Method\n    .PostAsync(\n        It.IsAny<string>(),\n        It.IsHttpContent("application/octet-stream").WithBytes([0x01, 0x02, 0x03, ]))\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n'})}),"\n",(0,i.jsx)(t.h3,{id:"form-data-content",children:"Form data content"}),"\n",(0,i.jsx)(t.p,{children:"To verify against the URL-encoded form data content, use the following methods:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithFormData(string, string)"}),": checks that the form-data content contains the provided key-value pair"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithFormData(IEnumerable<(string, string)>)"}),": checks that the form-data content contains the provided key-value\npairs"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:".WithFormData(string)"}),": checks that the form-data content contains the provided raw form data string"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'httpClient.SetupMock.Method\n    .PostAsync(\n        It.IsAny<string>(),\n        It.IsHttpContent("application/x-www-form-urlencoded").WithFormData("my-key", "my-value"))\n    .ReturnsAsync(new HttpResponseMessage(HttpStatusCode.OK));\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Similar to the query parameter matching, the order of the form-data key-value pairs does not matter."}),"\n",(0,i.jsxs)(t.li,{children:["Add the ",(0,i.jsx)(t.code,{children:".Exactly()"})," modifier to also check that no other form-data is present."]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453(e,t,n){n.d(t,{R:()=>c,x:()=>r});var s=n(6540);const i={},o=s.createContext(i);function c(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);